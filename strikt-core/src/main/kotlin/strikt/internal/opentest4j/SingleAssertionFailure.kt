package strikt.internal.opentest4j

import org.opentest4j.AssertionFailedError
import org.opentest4j.ValueWrapper
import strikt.api.Status.ComparisonFailed
import strikt.internal.AssertionSubject
import strikt.internal.reporting.writeToString

internal class SingleAssertionFailure(
  private val failure: AssertionSubject<*>,
  cause: Throwable?
) : AssertionFailedError(null, cause) {
  override val message: String?
    get() = failure.writeToString()

  override fun isActualDefined(): Boolean =
    failure.status is ComparisonFailed

  override fun getActual(): ValueWrapper? =
    (failure.status as? ComparisonFailed)
      ?.actual
      ?.let(ValueWrapper::create)

  override fun isExpectedDefined(): Boolean =
    failure.status is ComparisonFailed

  override fun getExpected(): ValueWrapper? =
    (failure.status as? ComparisonFailed)
      ?.expected
      ?.let(ValueWrapper::create)
}
