package strikt.internal.opentest4j

import org.opentest4j.MultipleFailuresError
import strikt.internal.AssertionSubject
import strikt.internal.reporting.writeToString

internal class CompoundAssertionFailure(
  private val failure: AssertionSubject<*>,
  errors: List<Throwable>
) : MultipleFailuresError("", errors) {
  override val message: String?
    get() = failure.writeToString()

  override fun getFailures(): List<Throwable> =
    super.getFailures().flatMap {
      when (it) {
        is CompoundAssertionFailure -> it.failures
        else -> listOf(it)
      }
    }
}
